<div class="pending-payments-container">
    <div class="header">
        <h2>Pending Payments</h2>
        <button class="btn-refresh" (click)="fetchPendingPayments()" [disabled]="loading">
            <span *ngIf="!loading">üîÑ Refresh</span>
            <span *ngIf="loading">‚è≥ Loading...</span>
        </button>
    </div>

    <!-- Search Filters -->
    <div class="filter-card">
        <div class="filter-grid">
            <div class="filter-group">
                <label>Session ID</label>
                <input type="text" placeholder="Search by Session ID" [(ngModel)]="searchSessionId"
                    (input)="applyFilters()" />
            </div>
            <div class="filter-group">
                <label>Start Date</label>
                <input type="date" [(ngModel)]="startDate" (change)="applyFilters()" />
            </div>
            <div class="filter-group">
                <label>End Date</label>
                <input type="date" [(ngModel)]="endDate" (change)="applyFilters()" />
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div class="alert alert-success" *ngIf="successMessage">
        ‚úÖ {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div class="alert alert-error" *ngIf="error">
        ‚ùå {{ error }}
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading && pendingPayments.length === 0">
        <div class="spinner"></div>
        <p>Loading pending payments...</p>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && pendingPayments.length === 0">
        <div class="empty-icon">üí∞</div>
        <h3>No Pending Payments</h3>
        <p>All admin session payments have been processed or there are no pending payments at this time.</p>
    </div>

    <!-- Payments Table -->
    <div class="table-container" *ngIf="!loading && pendingPayments.length > 0">
        <table class="payments-table">
            <thead>
                <tr>
                    <th>Transaction ID</th>
                    <th>Session ID</th>
                    <th>Username</th>
                    <th>Phone Number</th>
                    <th>Energy (kWh)</th>
                    <th>Amount (‚Çπ)</th>
                    <th>Charge Point</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let payment of pendingPayments">
                    <td data-label="Transaction ID"><span class="badge-id">#{{ payment.transactionId }}</span></td>
                    <td data-label="Session ID"><strong>{{ payment.sessionId }}</strong></td>
                    <td data-label="Username">{{ payment.username || 'N/A' }}</td>
                    <td data-label="Phone Number">{{ payment.phoneNumber || 'N/A' }}</td>
                    <td data-label="Energy">{{ payment.energyUsedKWh | number:'1.3-3' }} kWh</td>
                    <td data-label="Amount" class="amount">‚Çπ{{ payment.consumedAmount | number:'1.2-2' }}</td>
                    <td data-label="Charge Point">{{ payment.chargePointId }}</td>
                    <td data-label="Start Time">{{ formatDate(payment.startTime) }}</td>
                    <td data-label="End Time">{{ formatDate(payment.endTime) }}</td>
                    <td data-label="Status"><span class="status-badge pending">{{ payment.paymentStatus }}</span></td>

                    <!-- Actions -->
                    <td data-label="Actions" class="actions">
                        <button class="btn btn-mark-paid" (click)="openConfirmModal(payment)"
                            [disabled]="markingAsPaid">
                            üí∞ Mark as Paid
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Payment Count -->
    <div class="footer" *ngIf="!loading && pendingPayments.length > 0">
        <p>Total Pending Payments: <strong>{{ pendingPayments.length }}</strong></p>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showConfirmModal" (click)="closeConfirmModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>‚ö†Ô∏è Confirm Mark as Paid</h3>
            <button class="close-btn" (click)="closeConfirmModal()" type="button">‚úï</button>
        </div>

        <div class="modal-body">
            <div class="payment-info">
                <div class="info-row">
                    <span class="label">Transaction ID:</span>
                    <span class="value">#{{ selectedPayment?.transactionId }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Session ID:</span>
                    <span class="value">{{ selectedPayment?.sessionId }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Username:</span>
                    <span class="value">{{ selectedPayment?.username || 'N/A' }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Phone Number:</span>
                    <span class="value">{{ selectedPayment?.phoneNumber || 'N/A' }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Amount:</span>
                    <span class="value amount">‚Çπ{{ selectedPayment?.consumedAmount | number:'1.2-2' }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Energy Used:</span>
                    <span class="value">{{ selectedPayment?.energyUsedKWh | number:'1.3-3' }} kWh</span>
                </div>
            </div>

            <div class="warning-box">
                <p class="warning-icon">‚ö†Ô∏è</p>
                <p class="warning-text">
                    <strong>Warning:</strong> This action will mark this payment as paid and cannot be undone.
                    Please verify the payment has been received before confirming.
                </p>
            </div>

            <div class="error-message" *ngIf="error">
                <p>‚ùå {{ error }}</p>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-cancel" (click)="closeConfirmModal()" [disabled]="markingAsPaid" type="button">
                ‚ùå Cancel
            </button>
            <button class="btn btn-confirm" (click)="markAsPaid()" [disabled]="markingAsPaid" type="button">
                <span *ngIf="!markingAsPaid">‚úÖ Confirm - Mark as Paid</span>
                <span *ngIf="markingAsPaid">‚è≥ Processing...</span>
            </button>
        </div>
    </div>
</div>